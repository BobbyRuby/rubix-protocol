# RUBIX ECOSYSTEM: PHP_LIBRARIES
# SCOPE: Frameworks|Libraries|Tools (beyond Laravel/WordPress - see respective files)
# PHILOSOPHY: pragmatic|web_focused|composer_ecosystem

==============================================================================
WEB_FRAMEWORKS
==============================================================================
SYMFONY
desc:enterprise_PHP_framework|components
site:symfony.com
use_for:enterprise_apps|APIs|complex_systems
+components:reusable_standalone
+flex:minimal_boilerplate
+long_term_support:stability

composer create-project symfony/skeleton my-project
cd my-project
composer require webapp

// Controller
namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\JsonResponse;
use Symfony\Component\Routing\Annotation\Route;

class UserController extends AbstractController
{
    #[Route('/users/{id}', methods: ['GET'])]
    public function show(int $id, UserRepository $repository): JsonResponse
    {
        $user = $repository->find($id);
        if (!$user) {
            throw $this->createNotFoundException();
        }
        return $this->json($user);
    }
    
    #[Route('/users', methods: ['POST'])]
    public function create(Request $request, EntityManagerInterface $em): JsonResponse
    {
        $data = json_decode($request->getContent(), true);
        $user = new User();
        $user->setName($data['name']);
        $user->setEmail($data['email']);
        $em->persist($user);
        $em->flush();
        return $this->json($user, 201);
    }
}

// Service injection
class UserService
{
    public function __construct(
        private UserRepository $repository,
        private LoggerInterface $logger
    ) {}
}

SLIM
desc:micro_framework|PSR_compliant
site:slimframework.com
use_for:APIs|microservices|simple_apps
+lightweight:minimal
+PSR_7:HTTP_messages
+middleware:stack

composer require slim/slim slim/psr7

use Slim\Factory\AppFactory;
use Psr\Http\Message\ResponseInterface as Response;
use Psr\Http\Message\ServerRequestInterface as Request;

$app = AppFactory::create();

$app->get('/users/{id}', function (Request $request, Response $response, array $args) {
    $id = $args['id'];
    $user = $this->get('userRepository')->find($id);
    $response->getBody()->write(json_encode($user));
    return $response->withHeader('Content-Type', 'application/json');
});

$app->post('/users', function (Request $request, Response $response) {
    $data = $request->getParsedBody();
    // Create user
    return $response->withStatus(201);
});

$app->run();

LAMINAS_MEZZIO
desc:PSR_15_middleware|formerly_Zend_Expressive
site:docs.mezzio.dev
use_for:enterprise_APIs|middleware_apps

CODEIGNITER_4
desc:simple_MVC_framework
site:codeigniter.com
use_for:simple_apps|rapid_development
+lightweight:small_footprint
+simple:easy_learning_curve

YIII_3
desc:high_performance_framework
site:yiiframework.com
+fast:optimized
+components:modular

API_PLATFORM
desc:API_first_framework|Symfony_based
site:api-platform.com
use_for:REST_GraphQL_APIs|CRUD
+automatic:OpenAPI|GraphQL|Admin
+Symfony:integration

// Entity becomes API automatically
#[ApiResource]
#[ORM\Entity]
class User
{
    #[ORM\Id, ORM\GeneratedValue, ORM\Column]
    private ?int $id = null;
    
    #[ORM\Column(length: 255)]
    #[Assert\NotBlank]
    private string $name;
    
    #[ORM\Column(length: 255, unique: true)]
    #[Assert\Email]
    private string $email;
}

==============================================================================
DATABASE_ORM
==============================================================================
DOCTRINE_ORM
desc:enterprise_ORM|data_mapper
site:doctrine-project.org
use_for:complex_domain_models|enterprise
+data_mapper:separation_of_concerns
+DQL:object_query_language
+migrations:schema_management

// Entity
#[ORM\Entity(repositoryClass: UserRepository::class)]
#[ORM\Table(name: 'users')]
class User
{
    #[ORM\Id]
    #[ORM\GeneratedValue]
    #[ORM\Column]
    private ?int $id = null;
    
    #[ORM\Column(length: 255)]
    private string $name;
    
    #[ORM\Column(length: 255, unique: true)]
    private string $email;
    
    #[ORM\OneToMany(mappedBy: 'user', targetEntity: Order::class, cascade: ['persist'])]
    private Collection $orders;
    
    #[ORM\ManyToMany(targetEntity: Role::class)]
    #[ORM\JoinTable(name: 'user_roles')]
    private Collection $roles;
    
    public function __construct()
    {
        $this->orders = new ArrayCollection();
        $this->roles = new ArrayCollection();
    }
}

// Repository
class UserRepository extends ServiceEntityRepository
{
    public function findActiveUsers(): array
    {
        return $this->createQueryBuilder('u')
            ->where('u.active = :active')
            ->setParameter('active', true)
            ->orderBy('u.name', 'ASC')
            ->getQuery()
            ->getResult();
    }
    
    public function findWithOrders(int $id): ?User
    {
        return $this->createQueryBuilder('u')
            ->leftJoin('u.orders', 'o')
            ->addSelect('o')
            ->where('u.id = :id')
            ->setParameter('id', $id)
            ->getQuery()
            ->getOneOrNullResult();
    }
}

// Migrations
php bin/console doctrine:migrations:diff
php bin/console doctrine:migrations:migrate

ELOQUENT_STANDALONE
desc:Laravel_ORM_standalone
composer require illuminate/database illuminate/events

use Illuminate\Database\Capsule\Manager as Capsule;

$capsule = new Capsule;
$capsule->addConnection([
    'driver' => 'mysql',
    'host' => 'localhost',
    'database' => 'mydb',
    'username' => 'root',
    'password' => '',
]);
$capsule->setAsGlobal();
$capsule->bootEloquent();

// Use Eloquent models anywhere
$users = User::where('active', true)->get();

CYCLE_ORM
desc:modern_ORM|DataMapper
site:cycle-orm.dev
+annotation_free:schema_from_code
+async_ready:Swoole|RoadRunner

REDBEAN
desc:zero_config_ORM
$user = R::dispense('user');
$user->name = 'John';
$user->email = 'john@example.com';
R::store($user);

$users = R::find('user', 'active = ?', [true]);

==============================================================================
HTTP_CLIENTS
==============================================================================
GUZZLE
desc:HTTP_client|PSR_18
site:docs.guzzlephp.org
+PSR_7:HTTP_messages
+async:promises
+middleware:handlers

composer require guzzlehttp/guzzle

use GuzzleHttp\Client;

$client = new Client([
    'base_uri' => 'https://api.example.com',
    'timeout' => 10.0,
    'headers' => [
        'Authorization' => 'Bearer ' . $token,
        'Accept' => 'application/json',
    ],
]);

// GET
$response = $client->get('/users/1');
$user = json_decode($response->getBody(), true);

// POST
$response = $client->post('/users', [
    'json' => ['name' => 'John', 'email' => 'john@example.com'],
]);

// Async
$promise = $client->getAsync('/users');
$promise->then(
    fn($response) => handleResponse($response),
    fn($exception) => handleError($exception)
);

// Concurrent
$promises = [
    'user' => $client->getAsync('/users/1'),
    'orders' => $client->getAsync('/users/1/orders'),
];
$results = \GuzzleHttp\Promise\Utils::settle($promises)->wait();

SYMFONY_HTTP_CLIENT
desc:Symfony_HTTP_component
use Symfony\Component\HttpClient\HttpClient;

$client = HttpClient::create();
$response = $client->request('GET', 'https://api.example.com/users');
$users = $response->toArray();

// Async
$response = $client->request('GET', $url);
// Request starts, continues in background
$statusCode = $response->getStatusCode(); // Blocks here

==============================================================================
TEMPLATING
==============================================================================
TWIG
desc:secure_templating|Symfony_default
site:twig.symfony.com
+secure:auto_escaping
+extensible:filters|functions
+inheritance:template_extends

{# base.html.twig #}
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}{% endblock %}</title>
</head>
<body>
    {% block content %}{% endblock %}
</body>
</html>

{# users/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Users{% endblock %}

{% block content %}
    <h1>Users</h1>
    {% for user in users %}
        <div>
            {{ user.name }} - {{ user.email }}
            {% if user.active %}
                <span class="badge">Active</span>
            {% endif %}
        </div>
    {% else %}
        <p>No users found.</p>
    {% endfor %}
{% endblock %}

{# Filters #}
{{ name|upper }}
{{ date|date('Y-m-d') }}
{{ content|raw }}
{{ list|join(', ') }}

BLADE_STANDALONE
desc:Laravel_templating_standalone
composer require jenssegers/blade

PLATES
desc:native_PHP_templates
site:platesphp.com
+native_PHP:no_new_syntax
+fast:no_compilation

==============================================================================
TESTING
==============================================================================
PHPUNIT
desc:testing_framework|standard
site:phpunit.de

use PHPUnit\Framework\TestCase;

class UserServiceTest extends TestCase
{
    private UserService $service;
    private MockObject $repository;
    
    protected function setUp(): void
    {
        $this->repository = $this->createMock(UserRepository::class);
        $this->service = new UserService($this->repository);
    }
    
    public function testFindUserReturnsUser(): void
    {
        $user = new User('John', 'john@example.com');
        
        $this->repository
            ->expects($this->once())
            ->method('find')
            ->with(1)
            ->willReturn($user);
        
        $result = $this->service->findUser(1);
        
        $this->assertSame($user, $result);
        $this->assertEquals('John', $result->getName());
    }
    
    public function testFindUserThrowsOnNotFound(): void
    {
        $this->repository->method('find')->willReturn(null);
        
        $this->expectException(UserNotFoundException::class);
        
        $this->service->findUser(999);
    }
    
    #[DataProvider('validEmailProvider')]
    public function testValidEmails(string $email, bool $expected): void
    {
        $this->assertEquals($expected, $this->service->isValidEmail($email));
    }
    
    public static function validEmailProvider(): array
    {
        return [
            ['test@example.com', true],
            ['invalid', false],
            ['test@', false],
        ];
    }
}

PEST
desc:elegant_testing|Laravel_ecosystem
site:pestphp.com
+elegant:minimal_syntax
+expectations:fluent
+Laravel:integration

test('user can be created', function () {
    $user = User::create(['name' => 'John', 'email' => 'john@example.com']);
    
    expect($user)
        ->toBeInstanceOf(User::class)
        ->name->toBe('John')
        ->email->toBe('john@example.com');
});

it('throws on invalid email', function () {
    User::create(['name' => 'John', 'email' => 'invalid']);
})->throws(ValidationException::class);

it('can find active users', function () {
    User::factory()->count(3)->active()->create();
    User::factory()->count(2)->inactive()->create();
    
    expect(User::active()->get())->toHaveCount(3);
});

MOCKERY
desc:mocking_framework
$mock = Mockery::mock(UserRepository::class);
$mock->shouldReceive('find')
    ->once()
    ->with(1)
    ->andReturn($user);

$mock->shouldReceive('save')
    ->with(Mockery::type(User::class))
    ->andReturnUsing(fn($user) => $user);

CODECEPTION
desc:full_stack_testing|BDD
// Acceptance test
$I = new AcceptanceTester($scenario);
$I->amOnPage('/login');
$I->fillField('email', 'user@example.com');
$I->fillField('password', 'secret');
$I->click('Login');
$I->see('Welcome');

==============================================================================
DEPENDENCY_INJECTION
==============================================================================
PHP_DI
desc:dependency_injection_container
site:php-di.org

use DI\ContainerBuilder;

$containerBuilder = new ContainerBuilder();
$containerBuilder->addDefinitions([
    UserRepository::class => \DI\autowire(),
    UserService::class => \DI\autowire()
        ->constructorParameter('logger', \DI\get(LoggerInterface::class)),
    LoggerInterface::class => \DI\factory(function () {
        return new Logger('app');
    }),
]);

$container = $containerBuilder->build();
$service = $container->get(UserService::class);

SYMFONY_DI
desc:Symfony_DI_component
// services.yaml
services:
    _defaults:
        autowire: true
        autoconfigure: true
    
    App\:
        resource: '../src/'
        exclude:
            - '../src/Entity/'
    
    App\Service\UserService:
        arguments:
            $apiKey: '%env(API_KEY)%'

LEAGUE_CONTAINER
desc:simple_container|PSR_11
$container = new League\Container\Container;
$container->add(UserService::class)->addArgument(UserRepository::class);

==============================================================================
VALIDATION
==============================================================================
SYMFONY_VALIDATOR
desc:validation_component
use Symfony\Component\Validator\Constraints as Assert;
use Symfony\Component\Validator\Validation;

class CreateUserRequest
{
    #[Assert\NotBlank]
    #[Assert\Length(min: 2, max: 100)]
    public string $name;
    
    #[Assert\NotBlank]
    #[Assert\Email]
    public string $email;
    
    #[Assert\PositiveOrZero]
    #[Assert\LessThan(150)]
    public ?int $age = null;
}

$validator = Validation::createValidatorBuilder()
    ->enableAnnotationMapping()
    ->getValidator();

$violations = $validator->validate($request);
if (count($violations) > 0) {
    foreach ($violations as $violation) {
        echo $violation->getPropertyPath() . ': ' . $violation->getMessage();
    }
}

RESPECT_VALIDATION
desc:fluent_validation
use Respect\Validation\Validator as v;

v::stringType()->length(1, 100)->validate($name);
v::email()->validate($email);
v::intVal()->positive()->between(1, 150)->validate($age);

// Combined
$userValidator = v::attribute('name', v::stringType()->length(1, 100))
    ->attribute('email', v::email())
    ->attribute('age', v::optional(v::intVal()->positive()));

$userValidator->assert($user);

==============================================================================
QUEUE_ASYNC
==============================================================================
SYMFONY_MESSENGER
desc:message_bus|async_processing
// Message
class SendEmailNotification
{
    public function __construct(
        public readonly int $userId,
        public readonly string $subject
    ) {}
}

// Handler
#[AsMessageHandler]
class SendEmailNotificationHandler
{
    public function __invoke(SendEmailNotification $message): void
    {
        // Send email
    }
}

// Dispatch
$bus->dispatch(new SendEmailNotification($userId, 'Welcome'));

// config/packages/messenger.yaml
framework:
    messenger:
        transports:
            async: '%env(MESSENGER_TRANSPORT_DSN)%'
        routing:
            'App\Message\SendEmailNotification': async

BEANSTALKD_PHEANSTALK
desc:simple_queue
$pheanstalk = Pheanstalk::create('127.0.0.1');

// Producer
$pheanstalk->useTube('emails')->put(json_encode($job));

// Consumer
while ($job = $pheanstalk->watch('emails')->reserve()) {
    $data = json_decode($job->getData(), true);
    processJob($data);
    $pheanstalk->delete($job);
}

==============================================================================
CACHING
==============================================================================
SYMFONY_CACHE
desc:PSR_6_PSR_16_cache
use Symfony\Component\Cache\Adapter\RedisAdapter;

$cache = new RedisAdapter(
    RedisAdapter::createConnection('redis://localhost')
);

// PSR-6
$item = $cache->getItem('user_1');
if (!$item->isHit()) {
    $item->set($user);
    $item->expiresAfter(3600);
    $cache->save($item);
}
$user = $item->get();

// PSR-16 simple
$cache = new Psr16Cache($psr6Cache);
$cache->set('key', 'value', 3600);
$value = $cache->get('key', 'default');

PREDIS
desc:Redis_client
$client = new Predis\Client('tcp://127.0.0.1:6379');

$client->set('key', 'value');
$client->setex('key', 3600, 'value');
$value = $client->get('key');

// Pipeline
$responses = $client->pipeline(function ($pipe) {
    $pipe->set('key1', 'value1');
    $pipe->set('key2', 'value2');
    $pipe->get('key1');
});

==============================================================================
LOGGING
==============================================================================
MONOLOG
desc:logging_library|PSR_3
site:github.com/Seldaek/monolog
+handlers:many_outputs
+processors:context_enrichment
+formatters:flexible

use Monolog\Logger;
use Monolog\Handler\StreamHandler;
use Monolog\Handler\RotatingFileHandler;
use Monolog\Formatter\JsonFormatter;

$logger = new Logger('app');

// Console handler
$logger->pushHandler(new StreamHandler('php://stdout', Logger::DEBUG));

// File handler with rotation
$fileHandler = new RotatingFileHandler('logs/app.log', 30, Logger::INFO);
$fileHandler->setFormatter(new JsonFormatter());
$logger->pushHandler($fileHandler);

// Usage
$logger->info('User logged in', ['user_id' => $userId, 'ip' => $ip]);
$logger->error('Database error', ['exception' => $e->getMessage()]);

==============================================================================
UTILITIES
==============================================================================
CARBON
desc:datetime_library|Laravel_included
use Carbon\Carbon;

$now = Carbon::now();
$yesterday = Carbon::yesterday();
$nextWeek = Carbon::now()->addWeek();

$date = Carbon::parse('2024-01-15');
$date->format('F j, Y');  // January 15, 2024
$date->diffForHumans();   // 3 months ago

$date->isWeekend();
$date->isFuture();
$date->age;  // Years since date

COLLECTIONS
desc:Laravel_collections_standalone
composer require illuminate/collections

use Illuminate\Support\Collection;

$collection = collect([1, 2, 3, 4, 5]);

$collection->map(fn($item) => $item * 2);
$collection->filter(fn($item) => $item > 2);
$collection->sum();
$collection->avg();
$collection->groupBy('category');
$collection->pluck('name');
$collection->unique();
$collection->sortBy('name');

UUID
desc:UUID_generation
use Ramsey\Uuid\Uuid;

$uuid = Uuid::uuid4();
$uuid->toString();  // "f47ac10b-58cc-4372-a567-0e02b2c3d479"

Uuid::isValid($string);

FLYSYSTEM
desc:filesystem_abstraction
site:flysystem.thephpleague.com
+adapters:local|S3|FTP|etc
+unified_API:same_interface

use League\Flysystem\Filesystem;
use League\Flysystem\Local\LocalFilesystemAdapter;
use League\Flysystem\AwsS3V3\AwsS3V3Adapter;

// Local
$adapter = new LocalFilesystemAdapter('/path/to/root');
$filesystem = new Filesystem($adapter);

// S3
$adapter = new AwsS3V3Adapter($s3Client, 'bucket-name');
$filesystem = new Filesystem($adapter);

// Same API for both
$filesystem->write('path/to/file.txt', 'contents');
$contents = $filesystem->read('path/to/file.txt');
$filesystem->delete('path/to/file.txt');
$listing = $filesystem->listContents('path/to/dir');

==============================================================================
CLI
==============================================================================
SYMFONY_CONSOLE
desc:CLI_framework
use Symfony\Component\Console\Command\Command;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;
use Symfony\Component\Console\Input\InputArgument;
use Symfony\Component\Console\Input\InputOption;

class ProcessUsersCommand extends Command
{
    protected static $defaultName = 'app:process-users';
    
    protected function configure(): void
    {
        $this
            ->setDescription('Process user data')
            ->addArgument('file', InputArgument::REQUIRED, 'Input file')
            ->addOption('dry-run', null, InputOption::VALUE_NONE, 'Dry run mode');
    }
    
    protected function execute(InputInterface $input, OutputInterface $output): int
    {
        $file = $input->getArgument('file');
        $dryRun = $input->getOption('dry-run');
        
        $output->writeln('<info>Processing...</info>');
        
        // Progress bar
        $progressBar = new ProgressBar($output, $total);
        $progressBar->start();
        foreach ($items as $item) {
            $progressBar->advance();
        }
        $progressBar->finish();
        
        return Command::SUCCESS;
    }
}

==============================================================================
CODE_QUALITY
==============================================================================
PHP_CS_FIXER
desc:code_style_fixer
composer require --dev friendsofphp/php-cs-fixer

// .php-cs-fixer.php
return (new PhpCsFixer\Config())
    ->setRules([
        '@PSR12' => true,
        'array_syntax' => ['syntax' => 'short'],
        'ordered_imports' => true,
    ])
    ->setFinder(PhpCsFixer\Finder::create()->in(__DIR__));

// Run
vendor/bin/php-cs-fixer fix

PHPSTAN
desc:static_analysis
composer require --dev phpstan/phpstan

// phpstan.neon
parameters:
    level: 8
    paths:
        - src
        - tests

// Run
vendor/bin/phpstan analyse

PSALM
desc:static_analysis|type_checker
composer require --dev vimeo/psalm
vendor/bin/psalm --init
vendor/bin/psalm

==============================================================================
DEPENDENCY_MATRIX
==============================================================================
WEB:Symfony|Slim|Laminas|CodeIgniter|API_Platform
ORM:Doctrine|Eloquent|Cycle|RedBean
HTTP:Guzzle|Symfony_HttpClient
TEMPLATING:Twig|Blade|Plates
TESTING:PHPUnit|Pest|Mockery|Codeception
DI:PHP-DI|Symfony_DI|League_Container
VALIDATION:Symfony_Validator|Respect
QUEUE:Symfony_Messenger|Pheanstalk
CACHE:Symfony_Cache|Predis
LOGGING:Monolog
CLI:Symfony_Console
QUALITY:PHP-CS-Fixer|PHPStan|Psalm
