# RUBIX TOOL: VITE_AND_BUILD_TOOLS
# VERSION: Vite_5.x|6.x
# FOUNDATION: Evan_You|ESM_native|Rollup
# PHILOSOPHY: instant_server_start|fast_HMR|optimized_builds

==============================================================================
VITE_HISTORY
==============================================================================
2020:Evan_You>created>Vue_ecosystem
2021:v2.0>framework_agnostic|SSR
2022:v3.0>esbuild_deps|cold_start_improvement
2023:v4.0>Rollup_3|SWC_support
2024:v5.0>Rollup_4|Node_18_required
2024:v6.0>Environment_API|experimental_features

WHY_VITE
+no_bundle_dev:native_ESM
+instant_cold_start:vs_Webpack_minutes
+fast_HMR:module_level_not_full_rebuild
+optimized_build:Rollup_production
+framework_agnostic:React|Vue|Svelte|Solid

VITE_VS_WEBPACK
Vite:dev_unbundled|prod_Rollup|fast_start|simple_config
Webpack:dev_bundled|prod_bundled|slow_start|complex_config

==============================================================================
VITE_SETUP
==============================================================================
CREATE_PROJECT
npm create vite@latest my-app
npm create vite@latest my-app -- --template react-ts
npm create vite@latest my-app -- --template vue-ts
npm create vite@latest my-app -- --template svelte-ts
npm create vite@latest my-app -- --template vanilla-ts

TEMPLATES
vanilla|vanilla-ts
vue|vue-ts
react|react-ts|react-swc|react-swc-ts
preact|preact-ts
lit|lit-ts
svelte|svelte-ts
solid|solid-ts
qwik|qwik-ts

PROJECT_STRUCTURE
my-app/
  index.html          # entry point
  vite.config.ts      # config
  src/
    main.ts           # JS entry
    App.tsx           # root component
  public/             # static assets
  package.json

==============================================================================
VITE_CONFIG_PATTERNS
==============================================================================
BASIC_CONFIG
// vite.config.ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
})

FULL_CONFIG
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@components': path.resolve(__dirname, './src/components'),
    },
  },
  
  server: {
    port: 3000,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, ''),
      },
    },
  },
  
  build: {
    outDir: 'dist',
    sourcemap: true,
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          utils: ['lodash', 'date-fns'],
        },
      },
    },
  },
  
  define: {
    __APP_VERSION__: JSON.stringify(process.env.npm_package_version),
  },
})

ENVIRONMENT_VARIABLES
# .env
VITE_API_URL=http://localhost:8080
VITE_APP_TITLE=My App

# usage
const apiUrl = import.meta.env.VITE_API_URL

!VITE_prefix_required_for_client_exposure
.env.local:local_overrides_gitignored
.env.development|.env.production:mode_specific

==============================================================================
VITE_PLUGINS
==============================================================================
OFFICIAL_PLUGINS
@vitejs/plugin-react:React_Fast_Refresh
@vitejs/plugin-react-swc:React_with_SWC
@vitejs/plugin-vue:Vue_3_SFC
@vitejs/plugin-vue-jsx:Vue_JSX
@vitejs/plugin-legacy:legacy_browser_support

COMMUNITY_PLUGINS
vite-plugin-svgr:SVG_as_React_components
vite-plugin-checker:TypeScript|ESLint_overlay
vite-plugin-pwa:PWA_support
unplugin-auto-import:auto_imports
unplugin-vue-components:auto_component_registration
vite-plugin-compression:gzip|brotli

PLUGIN_CONFIG
import react from '@vitejs/plugin-react'
import checker from 'vite-plugin-checker'
import { compression } from 'vite-plugin-compression2'

export default defineConfig({
  plugins: [
    react(),
    checker({ typescript: true, eslint: { lintCommand: 'eslint src' } }),
    compression({ algorithm: 'gzip' }),
  ],
})

==============================================================================
VITE_PATH_ALIASES
==============================================================================
CONFIG
// vite.config.ts
resolve: {
  alias: {
    '@': path.resolve(__dirname, './src'),
    '@components': path.resolve(__dirname, './src/components'),
    '@hooks': path.resolve(__dirname, './src/hooks'),
    '@utils': path.resolve(__dirname, './src/utils'),
    '@styles': path.resolve(__dirname, './src/styles'),
  },
}

// tsconfig.json (for TypeScript support)
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@hooks/*": ["src/hooks/*"],
      "@utils/*": ["src/utils/*"],
      "@styles/*": ["src/styles/*"]
    }
  }
}

USAGE
import { Button } from '@components/Button'
import { useAuth } from '@hooks/useAuth'
import { formatDate } from '@utils/date'

==============================================================================
VITE_BUILD_OPTIMIZATION
==============================================================================
CHUNK_SPLITTING
build: {
  rollupOptions: {
    output: {
      manualChunks: (id) => {
        if (id.includes('node_modules')) {
          if (id.includes('react')) return 'react-vendor'
          if (id.includes('lodash')) return 'lodash'
          return 'vendor'
        }
      },
    },
  },
}

BUNDLE_ANALYSIS
npm install rollup-plugin-visualizer -D

import { visualizer } from 'rollup-plugin-visualizer'

plugins: [
  visualizer({ open: true, gzipSize: true }),
]

MINIFICATION
build: {
  minify: 'terser',  // or 'esbuild' (default, faster)
  terserOptions: {
    compress: { drop_console: true },
  },
}

CODE_SPLITTING_DYNAMIC
// Automatic code splitting with dynamic imports
const LazyComponent = lazy(() => import('./HeavyComponent'))

==============================================================================
ESBUILD_PATTERNS
==============================================================================
WHEN_ESBUILD
+extremely_fast_bundling
+TypeScript|JSX_transform
+simple_builds
+library_bundling

CLI
esbuild src/index.ts --bundle --outfile=dist/bundle.js
esbuild src/index.ts --bundle --minify --sourcemap --target=es2020 --outfile=dist/bundle.js

API
import * as esbuild from 'esbuild'

await esbuild.build({
  entryPoints: ['src/index.ts'],
  bundle: true,
  minify: true,
  sourcemap: true,
  target: ['es2020'],
  outfile: 'dist/bundle.js',
  external: ['react', 'react-dom'],
  define: {
    'process.env.NODE_ENV': '"production"',
  },
})

==============================================================================
ROLLUP_PATTERNS
==============================================================================
WHEN_ROLLUP
+library_bundling
+tree_shaking_priority
+multiple_output_formats
+Vite_uses_for_production

CONFIG
// rollup.config.js
import resolve from '@rollup/plugin-node-resolve'
import commonjs from '@rollup/plugin-commonjs'
import typescript from '@rollup/plugin-typescript'
import { terser } from 'rollup-plugin-terser'

export default {
  input: 'src/index.ts',
  output: [
    { file: 'dist/bundle.cjs.js', format: 'cjs' },
    { file: 'dist/bundle.esm.js', format: 'esm' },
    { file: 'dist/bundle.umd.js', format: 'umd', name: 'MyLib' },
  ],
  external: ['react', 'react-dom'],
  plugins: [
    resolve(),
    commonjs(),
    typescript(),
    terser(),
  ],
}

==============================================================================
WEBPACK_PATTERNS
==============================================================================
WHEN_WEBPACK
+legacy_projects
+complex_requirements
+specific_loaders_needed
+micro_frontends

BASIC_CONFIG
// webpack.config.js
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  entry: './src/index.tsx',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].[contenthash].js',
    clean: true,
  },
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/,
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader', 'postcss-loader'],
      },
      {
        test: /\.(png|svg|jpg|jpeg|gif)$/i,
        type: 'asset/resource',
      },
    ],
  },
  resolve: {
    extensions: ['.tsx', '.ts', '.js'],
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
  plugins: [
    new HtmlWebpackPlugin({ template: './public/index.html' }),
  ],
  devServer: {
    port: 3000,
    hot: true,
    historyApiFallback: true,
  },
}

OPTIMIZATION
optimization: {
  splitChunks: {
    chunks: 'all',
    cacheGroups: {
      vendor: {
        test: /[\\/]node_modules[\\/]/,
        name: 'vendors',
        chunks: 'all',
      },
    },
  },
  runtimeChunk: 'single',
}

==============================================================================
TURBOPACK_PATTERNS
==============================================================================
WHEN_TURBOPACK
+Next.js_projects
+incremental_compilation
+Rust_based_speed

USAGE
# Next.js dev with Turbopack
next dev --turbo

STATUS
experimental:not_production_ready
next_js_only:currently

==============================================================================
TSC_PATTERNS
==============================================================================
TSCONFIG_RECOMMENDED
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src"],
  "exclude": ["node_modules", "dist"]
}

TYPE_CHECKING_ONLY
tsc --noEmit

WITH_VITE
!vite_handles_transpilation
!tsc_for_type_checking_only
!run_tsc_in_CI

==============================================================================
PACKAGE_JSON_SCRIPTS
==============================================================================
VITE_SCRIPTS
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint src --ext ts,tsx",
    "lint:fix": "eslint src --ext ts,tsx --fix",
    "format": "prettier --write src",
    "type-check": "tsc --noEmit",
    "test": "vitest",
    "test:coverage": "vitest --coverage"
  }
}

==============================================================================
CSS_HANDLING
==============================================================================
VITE_CSS_SUPPORT
+native_CSS_imports
+PostCSS_builtin
+CSS_Modules_builtin
+preprocessors:sass|less|stylus

CSS_MODULES
// Button.module.css
.button { background: blue; }

// Button.tsx
import styles from './Button.module.css'
<button className={styles.button}>

POSTCSS_CONFIG
// postcss.config.js
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

TAILWIND_SETUP
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p

// tailwind.config.js
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: { extend: {} },
  plugins: [],
}

// src/index.css
@tailwind base;
@tailwind components;
@tailwind utilities;

==============================================================================
STATIC_ASSETS
==============================================================================
PUBLIC_DIRECTORY
public/
  favicon.ico       # served at /favicon.ico
  robots.txt        # served at /robots.txt
  images/           # served at /images/

!not_processed_by_vite
!copied_as_is_to_dist

IMPORTED_ASSETS
import logo from './assets/logo.png'
// returns resolved URL

// in CSS
.bg { background: url('./assets/bg.png'); }

SVG_AS_COMPONENT
// with vite-plugin-svgr
import { ReactComponent as Logo } from './logo.svg'
<Logo />

// or URL
import logoUrl from './logo.svg'
<img src={logoUrl} />

==============================================================================
BUILD_TOOL_SELECTION
==============================================================================
DECISION_TREE
greenfield_app?:Vite
library?:Rollup|tsup
legacy_complex?:Webpack
Next.js?:built_in|Turbopack_experimental
maximum_speed?:esbuild

MIGRATION_PATH
Webpack>Vite:common_migration
CRA>Vite:recommended

==============================================================================
COMMON_SMELLS
==============================================================================
SMELL                    | DETECTION                        | FIX
------------------------|----------------------------------|------------------
No_Type_Checking        | no_tsc_in_build                  | tsc_--noEmit
Huge_Bundles            | no_code_splitting                | dynamic_imports|manualChunks
No_Aliases              | ../../../imports                 | path_aliases
Missing_Env_Prefix      | VITE_prefix_missing              | add_VITE_prefix
Dev_Deps_In_Bundle      | devDeps_imported                 | external|proper_deps
No_Source_Maps          | prod_no_sourcemap                | sourcemap:true
Unoptimized_Images      | large_images_in_src              | public_dir|optimization
No_Cache_Busting        | no_contenthash                   | filename_hash
